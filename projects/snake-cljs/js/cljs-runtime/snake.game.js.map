{"version":3,"sources":["snake/game.cljs"],"mappings":"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","names":["snake.game/get-next-food-pos","grid-size","snake","all-pos","cljs.core/set","iter__5523__auto__","s__11326","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","xs__6360__auto__","cljs.core/first","iterys__5519__auto__","s__11328","cljs.core/chunked-seq?","c__5521__auto__","size__5522__auto__","cljs.core/count","b__11330","cljs.core/chunk-buffer","i__11329","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__11327","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","fs__5520__auto__","cljs.core.concat","iter__11325","x","cljs.core.range","y","clojure.set.difference","cljs.core/vec","cljs.core/rand-nth","p__11331","vec__11332","cljs.core.nth","snake.game/get-next-pos","direction","G__11335","cljs.core/Keyword","js/Error","cljs.core/mod","snake.game/will-get-food?","food","cljs.core._EQ_","cljs.core/peek","snake.game/eat","state","map__11336","cljs.core/--destructure-map","cljs.core.get","score","growed-snake","cljs.core.conj","cljs.core.assoc","snake.game/move","map__11337","snake.game/eat-or-move","map__11338","p__11340","map__11341","snake.game/self-collided?","snake-head","cljs.core/boolean","p1__11339#","cljs.core/some","cljs.core/butlast","snake.game/check-dead","snake.game/update-high-score","x__5130__auto__","y__5131__auto__","snake.game/get-next-state","snake.game/get-initial-state","high-score","mid-screen","snake.game/change-direction","new-direction","forbidden-moves","cljs.core/contains?","cljs.core/chunk-first"],"sourcesContent":["(ns snake.game\n  (:require [clojure.set :as set]))\n\n(defn- get-next-food-pos\n  [grid-size snake]\n  (let [all-pos (set (for [x (range grid-size)\n                           y (range grid-size)]\n                       [x y]))]\n    (->> snake\n         set\n         (set/difference all-pos)\n         vec\n         rand-nth)))\n\n(defn- get-next-pos\n  [[x y] direction grid-size]\n  (case direction\n    :right [(mod (inc x) grid-size) y]\n    :left [(mod (dec x) grid-size) y]\n    :up [x (mod (dec y) grid-size)]\n    :down [x (mod (inc y) grid-size)]))\n\n(defn- will-get-food?\n  [snake direction food grid-size]\n  (= food (get-next-pos (peek snake) direction grid-size)))\n\n(defn- eat\n  [state]\n  (let [{:keys [grid-size snake food score]} state\n        growed-snake (conj snake food)]\n    (assoc state\n           :snake growed-snake\n           :food (get-next-food-pos grid-size growed-snake)\n           :score (inc score))))\n\n(defn- move\n  [state]\n  (let [{:keys [snake direction grid-size]} state]\n    (assoc state\n           :snake (conj (vec (rest snake))\n                        (get-next-pos (peek snake) direction grid-size)))))\n\n(defn- eat-or-move\n  [state]\n  (let [{:keys [snake direction food grid-size]} state]\n    (cond (will-get-food? snake direction food grid-size)\n          (eat state)\n          :else (move state))))\n\n(defn- self-collided?\n  [{snake :snake}]\n  (let [snake-head (peek snake)]\n    (boolean (some #(= % snake-head)\n                   (butlast snake)))))\n\n(defn- check-dead\n  [state]\n  (assoc state :dead (self-collided? state)))\n\n(defn update-high-score\n  [state]\n  (assoc state :high-score (cond (:dead state)\n                                 (max (:score state) (:high-score state))\n                                 :else (:high-score state))))\n\n(defn get-next-state\n  [state]\n  (-> state\n      eat-or-move\n      check-dead\n      update-high-score))\n\n(defn get-initial-state\n  [grid-size high-score]\n  (let [mid-screen (/ grid-size 2)\n        snake [[mid-screen mid-screen]]]\n    {:grid-size grid-size\n     :snake snake\n     :direction :right\n     :food (get-next-food-pos grid-size snake)\n     :score 0\n     :high-score high-score\n     :dead false}))\n\n(defn change-direction\n  [state new-direction]\n  (let [forbidden-moves #{[:up :down]\n                          [:down :up]\n                          [:left :right]\n                          [:right :left]}]\n    (cond (not (contains? forbidden-moves\n                          [(:direction state) new-direction]))\n          (assoc state :direction new-direction)\n          :else state)))\n"]}